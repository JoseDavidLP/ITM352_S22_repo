
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Karma">
    <link rel="stylesheet" href="style.css">
    <script src="./functions.js"></script>
    <script src="/session_data.js"></script>
    <script>
        let params = (new URL(document.location)).searchParams;
        if (params.has('products_key')) {
            var this_product_key = params.get('products_key');
        } else {
            document.write('no products key in query string');
            document.stop;
        }
        var products_data;
        var total = 0;
        loadJSON('get_products_data', function(response) {
            // Parsing JSON string into object
            products_data = JSON.parse(response);
        });
        loadJSON('get_cart', function (response) {
            cart_info = JSON.parse(response);
            for (product_key in cart_info) {
                total += cart_info[product_key].reduce((a, b) => a + b);
            }
        });
    </script>
</head>
<body>

        <!-- Navigation bar -->
     <div class="w3-main w3-content w3-padding" style="max-width:1200px;margin-top:75px">
        <center>
            <a href='index.html' style='color: darkgreen;'>Home</a>&nbsp&nbsp&nbsp;
            <script>
                for (products_key in products_data) {
                    if (products_key == this_product_key) continue;
                    document.write(`<a style='color: darkgreen;' href='./display_products.html?products_key=${products_key}'>${products_key}<a>&nbsp&nbsp&nbsp;`);
                }
            </script>
        
            <a href="login.html" style='color: darkgreen;'>Login</a>
        
            <a href="/logout" style='color: darkgreen;'>Logout</a>
        
            <a href="./cart.html" style='color: darkgreen;'>View Cart (<span id="cart_total">0</span>)</a>
            <script>
                cart_total.innerHTML = total;
            </script>
    
<div class="homepageLogo">
    <a href="./index.html">
        <img src="whiskeyphotos/whiskeyheader.jpg" width="100%"></img>
    </a>
</div>
<br>
</body>
    

    <h2>You have <span id="cart_total">0</span> items in your shopping cart:</h2>
    <script>cart_total.innerHTML = total;</script>
    <br></div>


    <table border="2" class="center">
        <tbody>
            <tr>
                <th width="43%">Item</th>
                <th width="11%">Quantity</th>
                <th width="13%">Price</th>
                <th width="54%">Extended Price</th>
            </tr>
            <script>
                subtotal = 0; //start subtotal with 0
                var products = products_data[this_product_key];
                //generate item rows for table
                for (i = 0; i < products.length; i++) {
                    if (quantities[i] > 0) {
                        //calculate extended price
                        extended_price = quantities[i] * products[i].price;
                        subtotal += extended_price;
                        //generate the product rows for table
                        document.write(`
                        <tr>
                        <td width="43%">${products[i].item}</td>
                        <td align="center" width="11%">${quantities[i]}</td>
                        <td width="13%">\$${products[i].price}</td>
                        <td width="54%">\$${extended_price.toFixed(2)}</td>
                        </tr>
                        `);
                    }
                }
                //Tax @4%
                var tax_rate = .045;
                var sales_tax = tax_rate * subtotal;

                //Discount
                var discount;
                if (subtotal > 15 && subtotal < 30) {
                    discount = 2.5;
                } else if (subtotal >= 30 && subtotal < 75) {
                    discount = 5;
                } else {
                    discount = subtotal * .15;
                }

                //Calculate Ggrand total
                var grand_total = subtotal + sales_tax - discount;
            </script>
            <tr>
                <td colspan="4" width="100%">&nbsp;</td>
            </tr>
            <!-- sub-total, tax, discount, and total -->
            <tr>
                <td colspan="3" width="67%">Sub-total</td>
                <td width="54%">$
                    <script>
                        document.write(subtotal.toFixed(2));
                    </script>
                </td>
            </tr>
            <tr>
                <td colspan="3" width="67%">HI Tax @ 4.5%
                </td>
                <td width="4%">$
                    <script>
                        document.write(sales_tax.toFixed(2));
                    </script>
                </td>
            </tr>
            <tr>
                <td colspan="3" width="67%">Online Order Discount</td>
                <td width="54%">$
                    <script>
                        document.write(discount.toFixed(2));
                    </script>
                </td>
            </tr>
            <tr>
                <td colspan="3" width="67%"><strong>Total</strong></td>
                <td width="54%"><b>$
            <script>document.write(grand_total.toFixed(2));</script>
          </b></td>
            </tr>
        </tbody>
    </table>
    </div>
    </div>
    
    
</body>
</table>
